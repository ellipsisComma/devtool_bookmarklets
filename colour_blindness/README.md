# `colour-blindness`

Adds an accessibility widget to the corner of the page allowing you to simulate colour-blindness and colour-weakness in red, green, or blue. The filters are based on &ldquo;[A physiologically-based model for simulation of color vision deficiency](https://pubmed.ncbi.nlm.nih.gov/19834201/)&rdquo; by Machado et al, specifically [the pre-computed values](https://www.inf.ufrgs.br/%7Eoliveira/pubs_files/CVD_Simulation/CVD_Simulation.html) based on the paper's formulae.

This bookmarklet creates a `div` element over the entire document and adds a backdrop filter to that element containing an SVG colour matrix filter. The values of the colour matrix match the selected colour and severity. The filter must be applied using `backdrop-filter` instead of `filter` because `filter` doesn't apply to certain backgrounds (e.g. `body` element backgrounds or certain properties of elements in shadow roots).

**Note:** the widget may not work on pages with strict content security policies (e.g. on GitHub). Try it on something like the [CSS-Tricks home page](https://css-tricks.com/).

**Warning:** the widget may not work in Safari version 17 and earlier, where `backdrop-filter` is unavailable without a `-webkit-` vendor prefix.

## Installation

Create a new bookmark on your toolbar and set the address/URL to this code:

```js
javascript:(()=>{let $="ellipsiscomma-bookmarklet-colour-blindness-test-filter";if(document.getElementById(`${$}-widget`))return;let e=new CSSStyleSheet;e.insertRule(`#${$}-widget {z-index: 999999;position: fixed;inset-block-end: 0.5rem;inset-inline-start: 0.5rem;display: grid;grid-template-columns: auto auto;justify-items: end;align-items: baseline;gap: 0.5rem;padding: 0.3rem;font-family: sans-serif !important;color: black !important;background-color: white !important;accent-color: auto !important;border: 2px solid black !important;}`),e.insertRule(`#${$}-widget > :nth-child(odd) {justify-self: end;}`),e.insertRule(`#${$}-widget > :nth-child(even) {justify-self: start;}`),e.insertRule(`#${$}-lens {z-index: 99999;position: fixed;top: 0;left: 0;width: 100%;height: 100%;pointer-events: none;}`),document.adoptedStyleSheets.push(e);let t=document.body.appendChild(document.createElement("div"));t.id=`${$}-widget`,t.innerHTML=`<input id="${$}-switch" type="checkbox"><label for="${$}-switch">Apply filter</label><label for="${$}-colour">Deficiency: </label><select id="${$}-colour"><option value="R" checked>red</option><option value="G">green</option><option value="B">blue</option></select><label for="${$}-severity">Severity: </label><select id="${$}-severity"><option value="1" checked>100%</option><option value="0.5">50%</option></select>`;let i=document.body.appendChild(document.createElement("div"));i.id=`${$}-lens`;let l={R:{"0.5":"0.458064 0.679578 -0.137642 0 0 0.092785 0.846313 0.060902 0 0 -0.007494 -0.016807 1.024301 0 0",1:"0.152286 1.052583 -0.204868 0 0 0.114503 0.786281 0.099216 0 0 -0.003882 -0.048116 1.051998 0 0"},G:{"0.5":"0.547494 0.607765 -0.155259 0 0 0.181692 0.781742 0.036566 0 0 -0.010410 0.027275 0.983136 0 0",1:"0.367322 0.860646 -0.227968 0 0 0.280085 0.672501 0.047413 0 0 -0.011820 0.042940 0.968881 0 0"},B:{"0.5":"1.017277 0.027029 -0.044306 0 0 -0.006113 0.958479 0.047634 0 0 0.006379 0.248708 0.744913 0 0",1:"1.255528 -0.076749 -0.178779 0 0 -0.078411 0.930809 0.147602 0 0 0.004733 0.691367 0.303900 0 0"}};t.querySelectorAll("input, select").forEach(e=>e.addEventListener("change",()=>{i.style.backdropFilter=t.querySelector(`#${$}-switch`).checked?`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg"><filter id="${$}" x="0" y="0" width="100%" height="100%"><feColorMatrix in="SourceGraphic" type="matrix" values="${l[t.querySelector(`#${$}-colour`).value][t.querySelector(`#${$}-severity`).value]} 0 0 0 1 0" /></filter></svg>#${$}')`:"unset"}))})();
```
